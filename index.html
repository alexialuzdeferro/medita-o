<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåë</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            min-height: 100vh;
            transition: background-color 1.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial', monospace;
            background-color: #000000;
        }
        
        /* Contador minimalista - apenas n√∫meros */
        #counter {
            position: fixed;
            bottom: 15px;
            right: 15px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 300;
            letter-spacing: 1px;
            padding: 5px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        
        #counter:hover {
            color: rgba(255, 255, 255, 0.7);
            transform: scale(1.05);
        }
        
        /* Indicador de nova cor */
        .color-change {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: pulse 2s ease-out;
            z-index: 0;
        }
        
        @keyframes pulse {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
            }
            100% {
                width: 200vmax;
                height: 200vmax;
                opacity: 0;
            }
        }
        
        /* Efeito de part√≠culas */
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            pointer-events: none;
        }
        
        /* Logs escondidos */
        #debug {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Contador apenas num√©rico -->
    <div id="counter">0</div>
    
    <!-- Debug escondido -->
    <div id="debug"></div>

    <script type="module">
        // Importa√ß√£o do Supabase
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
        
        // Configura√ß√£o - SUBSTITUA com sua chave anon
        const supabaseUrl = 'https://rmkcmvfmqwpzcoknznty.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJta2NtdmZtcXdwemNva256bnR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5ODkwNjYsImV4cCI6MjA4MTU2NTA2Nn0.RhAhAxRJEJN4mlDQmPgvdACprTE6B6xx_dMJ-YEELtM'
        
        // Inicializar Supabase
        const supabase = createClient(supabaseUrl, supabaseKey)
        
        // Elementos DOM
        const counterEl = document.getElementById('counter')
        const bodyEl = document.body
        const debugEl = document.getElementById('debug')
        
        // Paleta de cores para mudan√ßa (cores escuras elegantes)
        const colorPalette = [
            '#000000', // Preto puro
            '#0a0a0a', // Quase preto
            '#111111', // Cinza muito escuro
            '#1a1a1a', // Cinza escuro
            '#222222', // Cinza m√©dio-escuro
            '#2a2a2a', // Cinza
            '#1c1c2e', // Azul escuro
            '#1e2a1e', // Verde escuro
            '#2e1c1c', // Vinho escuro
            '#1c2e2e', // Ciano escuro
            '#2e2e1c', // Oliva escuro
            '#2c1c2e', // Roxo escuro
            '#1c2c2e', // Verde-azulado escuro
            '#2e1c2c'  // Magenta escuro
        ]
        
        // Gerar part√≠culas
        function createParticles(count) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div')
                particle.className = 'particle'
                
                // Posi√ß√£o aleat√≥ria
                particle.style.left = Math.random() * 100 + 'vw'
                particle.style.top = Math.random() * 100 + 'vh'
                
                // Tamanho aleat√≥rio
                const size = Math.random() * 3 + 1
                particle.style.width = size + 'px'
                particle.style.height = size + 'px'
                
                // Opacidade aleat√≥ria
                particle.style.opacity = Math.random() * 0.3 + 0.1
                
                // Adicionar ao body
                bodyEl.appendChild(particle)
                
                // Remover ap√≥s anima√ß√£o
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle)
                    }
                }, 3000)
            }
        }
        
        // Efeito de mudan√ßa de cor
        function showColorChange() {
            const changeIndicator = document.createElement('div')
            changeIndicator.className = 'color-change'
            bodyEl.appendChild(changeIndicator)
            
            // Remover ap√≥s anima√ß√£o
            setTimeout(() => {
                if (changeIndicator.parentNode) {
                    changeIndicator.parentNode.removeChild(changeIndicator)
                }
            }, 2000)
        }
        
        // Escolher cor baseada no n√∫mero de acessos
        function getColorFromCount(count) {
            // Usa o contador para selecionar cor da paleta
            const colorIndex = (count - 1) % colorPalette.length
            return colorPalette[colorIndex]
        }
        
        // Efeito de brilho no contador
        function pulseCounter() {
            counterEl.style.color = 'rgba(255, 255, 255, 0.8)'
            counterEl.style.textShadow = '0 0 15px rgba(255, 255, 255, 0.5)'
            
            setTimeout(() => {
                counterEl.style.color = 'rgba(255, 255, 255, 0.4)'
                counterEl.style.textShadow = '0 0 10px rgba(255, 255, 255, 0.1)'
            }, 800)
        }
        
        // Atualizar contador no Supabase
        async function updateCounter() {
            try {
                debugEl.innerHTML = 'Iniciando conex√£o...'
                
                const pageId = 'color_changer_page' // ID √∫nico para esta p√°gina
                
                // Tenta buscar contador existente
                const { data: existing, error: fetchError } = await supabase
                    .from('visit_counter')
                    .select('id, count')
                    .eq('page_id', pageId)
                    .single()
                
                let newCount
                
                if (fetchError && fetchError.code === 'PGRST116') {
                    // Criar novo registro
                    const { data: newData, error: insertError } = await supabase
                        .from('visit_counter')
                        .insert([{ 
                            page_id: pageId,
                            page_title: 'Color Changer',
                            count: 1
                        }])
                        .select()
                        .single()
                    
                    if (insertError) throw insertError
                    newCount = newData.count
                    
                } else if (fetchError) {
                    throw fetchError
                } else {
                    // Incrementar existente
                    const { data: updated, error: updateError } = await supabase
                        .from('visit_counter')
                        .update({ count: existing.count + 1 })
                        .eq('id', existing.id)
                        .select()
                        .single()
                    
                    if (updateError) throw updateError
                    newCount = updated.count
                }
                
                // Atualizar display
                counterEl.textContent = newCount
                
                // Mudar cor do fundo
                const newColor = getColorFromCount(newCount)
                bodyEl.style.backgroundColor = newColor
                
                // Efeitos visuais
                showColorChange()
                createParticles(50)
                pulseCounter()
                
                // Log para debug
                debugEl.innerHTML = `Acesso #${newCount} | Cor: ${newColor}`
                
            } catch (error) {
                console.error('Erro:', error)
                debugEl.innerHTML = `Erro: ${error.message}`
                
                // Fallback: usar localStorage
                const localCount = localStorage.getItem('color_page_count') || 0
                const newLocalCount = parseInt(localCount) + 1
                localStorage.setItem('color_page_count', newLocalCount)
                
                counterEl.textContent = newLocalCount
                
                // Mudar cor mesmo no fallback
                const newColor = getColorFromCount(newLocalCount)
                bodyEl.style.backgroundColor = newColor
                
                // Efeitos visuais
                showColorChange()
                createParticles(30)
                pulseCounter()
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', async () => {
            // Pequeno delay para efeito dram√°tico
            setTimeout(async () => {
                await updateCounter()
                
                // Adicionar mais part√≠culas periodicamente
                setInterval(() => {
                    createParticles(5)
                }, 5000)
                
                // Efeito de hover no contador
                counterEl.addEventListener('mouseenter', () => {
                    counterEl.style.transform = 'scale(1.2)'
                    counterEl.style.color = 'rgba(255, 255, 255, 0.9)'
                })
                
                counterEl.addEventListener('mouseleave', () => {
                    counterEl.style.transform = 'scale(1)'
                    counterEl.style.color = 'rgba(255, 255, 255, 0.4)'
                })
            }, 500)
        })
        
        // Atualizar quando a p√°gina fica vis√≠vel novidade
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                setTimeout(updateCounter, 2000)
            }
        })
    </script>
</body>
</html>
