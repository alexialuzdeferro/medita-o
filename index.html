<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contador Ãšnico</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: #000;
    height: 100vh;
    font-family: Arial, sans-serif;
}

/* Contador ultra discreto */
#counter {
    position: fixed;
    bottom: 12px;
    right: 12px;
    background: rgba(255,255,255,0.05);
    color: rgba(255,255,255,0.6);
    font-size: 11px;
    padding: 6px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(6px);
    z-index: 9999;
    user-select: none;
}

#count {
    color: #fff;
    font-size: 12px;
    margin-left: 4px;
}

.dot {
    display: inline-block;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    margin-left: 6px;
    background: rgba(74,222,128,0.5);
    animation: pulse 2s infinite;
}

.dot.offline {
    background: rgba(251,191,36,0.6);
    animation: none;
}

@keyframes pulse {
    0%,100% { opacity: .4 }
    50% { opacity: 1 }
}
</style>
</head>

<body>

<div id="counter" title="Visitantes totais">
    ðŸ‘¤ <span id="count">0</span>
    <span id="status" class="dot"></span>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ================= CONFIGURAÃ‡ÃƒO ================= */

const SUPABASE_URL = 'https://qgnprifuachmfxoaalax.supabase.co';
const SUPABASE_KEY = 'SUA_ANON_KEY_AQUI';
const SITE_NAME = 'site_alexialuzdeferro';

/* =============================================== */

const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
);

document.addEventListener('DOMContentLoaded', init);

async function init() {
    try {
        if (!sessionStorage.getItem('site_visited')) {
            const total = await incrementarContador();
            sessionStorage.setItem('site_visited', 'true');
            atualizarUI(total);
        } else {
            const total = await buscarContador();
            atualizarUI(total);
        }
    } catch (e) {
        usarModoOffline();
    }
}

/* ====== RPC SEGURO ====== */
async function incrementarContador() {
    const { data, error } = await supabase.rpc(
        'incrementar_page_view',
        { p_page_name: SITE_NAME }
    );

    if (error) throw error;
    return data;
}

/* ====== SELECT ====== */
async function buscarContador() {
    const { data, error } = await supabase
        .from('page_views')
        .select('view_count')
        .eq('page_name', SITE_NAME)
        .single();

    if (error) throw error;
    return data.view_count;
}

/* ====== UI ====== */
function atualizarUI(valor) {
    const el = document.getElementById('count');
    el.textContent = valor;
    el.style.transform = 'scale(1.3)';
    setTimeout(() => el.style.transform = 'scale(1)', 200);
}

/* ====== OFFLINE ====== */
function usarModoOffline() {
    let local = parseInt(localStorage.getItem('local_views') || '0');
    local++;
    localStorage.setItem('local_views', local);

    document.getElementById('count').textContent = local;
    document.getElementById('status').classList.add('offline');
}
</script>

</body>
</html>
